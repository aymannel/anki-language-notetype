<!-- Language-1 -> Native (Back) -->

<div id='backSide'>
  <div id='backStatusBar' class='statusBar'>
    <div id='reloadButton' onClick='reloadPage()'>
      <span class='reloadSymbol'>&#10227;</span>
    </div>
    <div id='audioStatus'>&#x1F3A7;</div>
  </div>

  {{FrontSide}}
</div>

</br>

<span id='native'>{{Native}}</span>

{{#Synonyms}}
    <div id='synonyms'>or {{Synonyms}}</div>
{{/Synonyms}}

</br>

{{Image}}


<!-- Scripts -->

<script>

  setTimeout(() => {

    // Nominal Agreement
    if (Persistence.isAvailable()) {
      reloadPage(Persistence.getItem());
      Persistence.clear();
    }

    // Context
    document.getElementById('native').innerHTML = formatContext(`{{Native}}`);

    // Reveal Elements
    document.getElementById('native').style.opacity = 1;

  }, 0);

  function reloadPage(wordIndex) {

    // Initialise Constants
    const newIndex = wordIndex ?? nextIndex();
    const language = stripHTML(`{{Language-1}}`);
    const classification = stripHTML(`{{Classification}}`);
    const audioSources = wordIndex != null ? null : stripHTML(`{{Audio-1}}`).split(' ');

    // Handle Agreement
    handleAgreementFront(language, classification, audioSources, newIndex);
    handleAgreementBack(language, classification, newIndex);

  }

  function formatContext(text) {
    const contextRegex = /\[([^\]]+)\]/g;
    return stripHTML(text).replace(contextRegex, '<span id="context">($1)</span>');
  }

  // function handleAgreementBack(wordIndex) {
  function handleAgreementBack(language, classification, storedIndex) {

    const words = language.split('/');
    const wordIndex = storedIndex ?? 0;
    const languageElement = document.getElementById('language');
    const classificationElement = document.getElementById('classification');

    agreementPhrases = [
        '<span style="color: #4E7BFD;">masc.</span> singular',
        '<span style="color: #FE3473;">fem.</span> singular',
        '<span style="color: #4E7BFD;">masc.</span> plural',
        '<span style="color: #FE3473;">fem.</span> plural'
    ];

    const agreementPhrasesCombined = [
      '<span style="color: #4E7BFD;">masc.</span> or <span style="color: #FE3473;">fem.</span> singular',
      '<span style="color: #4E7BFD;">masc.</span> or <span style="color: #FE3473;">fem.</span> plural'
    ];

    if (classification === 'adjective') {
      if (words.length === 2) {
        languageElement.innerHTML = words[wordIndex % 2];
        classificationElement.innerHTML = '(' + agreementPhrasesCombined[wordIndex % 2] + ')';
      }
      else if (words.length === 4) {
        languageElement.innerHTML = words[wordIndex];
        classificationElement.innerHTML = '(' + agreementPhrases[wordIndex] + ')';
      }
    }

    else if (classification === 'noun') {
      if (words.length === 2) {
        languageElement.innerHTML = words[wordIndex % 2];
        classificationElement.innerHTML = '(' + ['singular', 'plural'][wordIndex % 2] + ')';
      }
      else if (words.length === 4) {
        languageElement.innerHTML = words[wordIndex];
        classificationElement.innerHTML = '(' + agreementPhrases[wordIndex] + ')';
      }
    }

  }

</script>